<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <title th:text="${question.title}">问题</title>
    <script src="/webjars/jquery/1.11.1/jquery.min.js" type="application/javascript"></script>
    <script src="/webjars/bootstrap/3.3.7/js/bootstrap.min.js" type="application/javascript"></script>
    <link rel="stylesheet" href="/webjars/bootstrap/3.3.7/css/bootstrap.css">
    <style>
        .glyphicon {
            padding: 8px;
            color: #999999;
            font-size: 15px;
        }

        .glyphicon:hover {
            background-color: #499ef3;
            color: #ffffff;
        }
    </style>
</head>
<body>
<nav th:replace="component::topBar"></nav>
<div class="container-fluid" style="width: 87%;margin:30px auto;">
    <div class="row">
        <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
            <!--            正文-->
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2 th:text="${question.title}"><span class="glyphicon glyphicon-list" aria-hidden="true"></span>发现</h2>
                <p>
                    <span th:text="'作者:'+${question.basicUser.username}+' |'"></span>
                    <span th:text="'阅读数:'+${question.readCount}+' |'"></span>
                    <span th:text="'点赞数:'+${question.praiseCount}+' |'"></span>
                    <sapn th:text="'评论数:'+${question.commentCount}+' |'"></sapn>
                    <span th:text="'创建于:'+${question.getCreatedAt()}+' |'"></span>
                </p>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12"/>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" th:text="${question.detail}"></div>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12"/>
                <a href=""
                   th:if="${!#authentication.name.equals('anonymousUser')and #authentication.name.equals(question.basicUser.username)}"
                   th:href="@{'/publish/'+${question.id}}" style="color: #999999;font-size: 12px;">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true">编辑</span>
                </a>
            </div>
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12"/>
                <!--            回复列表-->
                <h3>回复数: <span th:text="${question.getCommentCount()}"></span></h3>
                <div class="media" th:if="${comments.size()>=0}" th:each="comment:${comments}">
                    <div class="media-left">
                        <a href="#">
                            <!--                            <p th:text="${question.basicUser.avatar_url}"></p>-->
                            <img th:src="${comment.getBasicUser().getAvatar_url()}" style="width: 64px"
                                 class="media-object img-circle"
                                 src="http://img3.imgtn.bdimg.com/it/u=1744365556,1648558001&fm=26&gp=0.jpg" alt="...">
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">
                            <a href="" th:text="${comment.basicUser.username}" style="font-size: 12px;"></a>
                        </h4>
                        <p th:text="${comment.getContent()}">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                            Consequuntur, mollitia!</p>
                        <p>
                            <span class="glyphicon glyphicon-thumbs-up" th:text="${comment.getPraiseCount()}">0</span>
                            <span class="glyphicon glyphicon-comment"></span>
                            <span class="pull-right" th:text="${comment.getModifiedAt()}">1</span>
                        </p>
                    </div>
                </div>

            </div>
            <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12"/>
            <!--            回复输入-->
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="media" th:if="${question!=null}">
                    <div class="media-left">
                        <h3>提交回复</h3>
                        <span th:text="${#authentication.getName().equals('anonymousUser')?'未登录':#authentication.getName()}"></span>
                        <!--                        <a href="#">-->
                        <!--                            <img  style="width: 64px" class="media-object img-rounded" th:src="${#authentication.getName()}" src="" alt="">-->
                        <!--                        </a>-->
                    </div>
                </div>
                <!--                <input type="hidden" id="commentator" th:value="${#authentication.getName()}">-->
                <input type="hidden" id="questionId" th:value="${question.id}">
                <textarea id="commentContent" name="" rows="5" class="form-control" style="margin: 10px 0;"></textarea>
                <button type="button" class="btn btn-success right" style="float: right" onclick="fun1()">回复</button>
            </div>
        </div>

        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h3>发起人</h3>
                    <div class="media">
                        <div class="media-left">
                            <a href="#">
                                <img th:src="${question.basicUser.avatar_url}" style="width: 64px"
                                     class="media-object img-rounded"
                                     src="http://img3.imgtn.bdimg.com/it/u=1744365556,1648558001&fm=26&gp=0.jpg"
                                     alt="...">
                            </a>
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">
                                <span th:text="${question.basicUser.username}"></span>
                            </h4>

                        </div>
                    </div>

                    <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12"/>
                    <h3>相关问题</h3>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function fun1() {
        var questionId = $("#questionId").val();
        var commentContent = $('#commentContent').val();
        // var commentator = $('#commentator').val();
        $.ajax({
            url: "/comment",
            type: "POST",
            data: JSON.stringify({
                "parentId": questionId,
                "content": commentContent,
                "type": 1,
                // "commentator":commentator
            }),
            success: function (response) {
                debugger
                console.log(response);
                if(response.code ===200){
                    debugger
                    window.location.reload();
                    scroll(0,0);
                }
            },
            error: function (request) {
                console.log(JSON.parse(request.responseText).message);
                console.log(request.status);
                console.log(request);
            },
            dataType: "json",
            contentType: "application/json; charset=utf-8"
        });
    }
</script>
</html>